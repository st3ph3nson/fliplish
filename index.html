<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fliplish Translator</title>

  <style>
    :root {
      --bg: #d8cbb8;                 /* night-light taupe */
      --panel: rgba(255,255,255,0.78);
      --border: rgba(17, 24, 39, 0.18);
      --text: #111827;
    }

    body {
      font-family: system-ui, -apple-system, Segoe UI, sans-serif;
      margin: 24px;
      line-height: 1.35;
      background: var(--bg);
      color: var(--text);
    }

    textarea {
      width: 100%;
      min-height: 140px;
      padding: 12px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      outline: none;
    }

    textarea:focus { border-color: rgba(17, 24, 39, 0.35); }

    .row {
      display: flex;
      gap: 12px;
      margin: 12px 0;
      flex-wrap: wrap;
      align-items: center;
    }

    button, select {
      padding: 10px 12px;
      font-size: 15px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.65);
      color: var(--text);
      cursor: pointer;
    }

    button:active { transform: translateY(1px); }

    .hint { opacity: 0.75; font-size: 13px; margin-top: 8px; }
  </style>
</head>

<body>
  <h1>Fliplish Translator</h1>

  <label for="input">Input</label>
  <textarea id="input" placeholder="Type English (or coded text) here..."></textarea>

  <div class="row">
    <button id="encode">Encode ‚Üí</button>
    <button id="decode">‚Üê Decode</button>
    <button id="clear">Clear</button>

    <label>
      Suffix mode:
      <select id="suffixMode">
        <option value="single" selected>Single</option>
        <option value="aeo">AEO Rotate</option>
      </select>
    </label>

    <label>
      Suffix:
      <select id="suffix"></select>
    </label>

    <label>
      Preserve capitalization:
      <select id="caps">
        <option value="yes">Yes</option>
        <option value="no" selected>No</option>
      </select>
    </label>
  </div>

  <label for="output">Output</label>
  <textarea id="output" readonly></textarea>

  <div class="hint">
    Rule: move first letter to end + add suffix (encode). Remove suffix + move last letter to front (decode).
    AEO Rotate counts only word tokens (punctuation doesn‚Äôt affect the cycle). Apostrophes inside words are preserved. üôÇ
  </div>

<script>
  const inputEl = document.getElementById("input");
  const outputEl = document.getElementById("output");
  const suffixEl = document.getElementById("suffix");
  const suffixModeEl = document.getElementById("suffixMode");
  const capsEl = document.getElementById("caps");
  const clearBtn = document.getElementById("clear");

  // Populate suffix dropdown with a‚Äìz (default = a)
  (function initSuffixOptions() {
    const letters = "abcdefghijklmnopqrstuvwxyz";
    const defaultSuffix = "a";
    suffixEl.innerHTML = "";
    for (const ch of letters) {
      const opt = document.createElement("option");
      opt.value = ch;
      opt.textContent = ch;
      if (ch === defaultSuffix) opt.selected = true;
      suffixEl.appendChild(opt);
    }
  })();

  // (Optional UX) Disable manual suffix picker when in AEO mode
  function syncSuffixUI() {
    const mode = suffixModeEl.value;
    suffixEl.disabled = (mode === "aeo");
    suffixEl.style.opacity = (mode === "aeo") ? "0.55" : "1";
  }
  suffixModeEl.addEventListener("change", syncSuffixUI);
  syncSuffixUI();

  // Tokenizer: keeps internal apostrophes together (supports ' and ‚Äô)
  // Words = letters possibly containing internal apostrophes. Everything else preserved.
  function tokenize(text) {
    return text.match(/[A-Za-z]+(?:['‚Äô][A-Za-z]+)*|[^A-Za-z]+/g) || [];
  }

  function detectCapsStyle(word) {
    if (word.toUpperCase() === word) return "upper";
    if (word[0].toUpperCase() === word[0] &&
        word.slice(1).toLowerCase() === word.slice(1)) return "title";
    return "lower";
  }

  function encodeWord(word, suffix, preserveCaps) {
    const style = preserveCaps ? detectCapsStyle(word) : "lower";
    const w = word.toLowerCase();
    if (w.length < 1) return word;

    let coded = w.slice(1) + w[0] + suffix;

    if (!preserveCaps) return coded;

    // Preserve ALL-CAPS words (USA -> SAUz)
    if (style === "upper") return coded.toUpperCase();

    // Preserve Title Case by keeping the ORIGINAL first letter capital,
    // even though it moved to the end (before suffix).
    if (style === "title") {
      const movedLetterIndex = coded.length - 1 - suffix.length; // position of moved first letter
      coded =
        coded.slice(0, movedLetterIndex) +
        coded[movedLetterIndex].toUpperCase() +
        coded.slice(movedLetterIndex + 1);
      return coded;
    }

    // lower
    return coded;
  }

  function decodeWord(word, suffix, preserveCaps) {
    const style = preserveCaps ? detectCapsStyle(word) : "lower";
    const w = word.toLowerCase();
    if (!w.endsWith(suffix) || w.length < 2) return word;

    const core = w.slice(0, -1);
    let plain = core.slice(-1) + core.slice(0, -1);

    if (!preserveCaps) return plain;

    // Preserve ALL-CAPS words
    if (style === "upper") return plain.toUpperCase();

    // Preserve Title Case by capitalizing the restored first letter
    if (style === "title") {
      plain = plain[0].toUpperCase() + plain.slice(1);
      return plain;
    }

    return plain;
  }

  // Picks suffix per word depending on mode.
  // wordIndex counts ONLY actual word tokens (commas/spaces don‚Äôt increment it).
  function getSuffixForWord(wordIndex) {
    const mode = suffixModeEl.value;
    if (mode === "aeo") {
      const cycle = ["a", "e", "o"];
      return cycle[wordIndex % cycle.length];
    }
    return suffixEl.value;
  }

  function transform(text, mode) {
    const preserveCaps = capsEl.value === "yes";
    const tokens = tokenize(text);

    let wordIndex = 0; // counts only word tokens
    const out = tokens.map(tok => {
      if (/^[A-Za-z]/.test(tok)) {
        const suffix = getSuffixForWord(wordIndex);
        const result = (mode === "encode")
          ? encodeWord(tok, suffix, preserveCaps)
          : decodeWord(tok, suffix, preserveCaps);
        wordIndex++;
        return result;
      }
      return tok; // punctuation/space/etc.
    });

    return out.join("");
  }

  document.getElementById("encode").onclick = () =>
    outputEl.value = transform(inputEl.value, "encode");

  document.getElementById("decode").onclick = () =>
    outputEl.value = transform(inputEl.value, "decode");

  clearBtn.onclick = () => {
    inputEl.value = "";
    outputEl.value = "";
    inputEl.focus();
  };
</script>
</body>
</html>